---
layout: post
title: OSI 7 계층과 주소창에 naver.com을 치면 일어나는 일
categories: Network
---

# OSI 7 계층
![osi7.png](https://github.com/user-attachments/assets/3473b88d-3e81-4dad-b1ce-6cf225d725fc)

1. 물리 계층
   - 물리적인 연결을 담당하며, 물리적 매체를 통해 데이터를 전송합니다.
   - 이더넷 케이블, 광섬유, 전송 매체의 전기적/ 광학적 특성

2. 데이터 링크 계층
   - 데이터의 오류를 감지하고 수정하며, 물리 계층을 통해 전송되는 데이터를 프레임으로 변환하여 전달합니다. 
     네트워크 내에서 노드간의 데이터 전송을 담당합니다.
   - MAC 주소, 스위치, 이더넷

3. 네트워크 계층
   - 라우터를 이용하여 최적의 경로를 설정하여 데이터를 전달하고 라우팅하는 과정을 수행합니다.
   - 트래픽 관리 및 패킷 분할을 수행합니다.
   - IP 주소, 라우터, IP 프로토콜

4. 전송 계층
   - 신뢰성 있는 데이터의 전송을 보장합니다.
   - 데이터 전송을 수행합니다.
   - TCP, UDP

5. 세션 계층
   - 세션을 연결하고 유지합니다.
   - 애플리케이션 간의 통신 세션을 관리하고, 데이터 교환의 동기화를 제공합니다.

6. 표현 계층
   - 데이터의 표현 방식을 관리합니다. 
   - 암호화 알고리즘등을 암호화 및 압축을 수행합니다. 
   - 데이터 압축, 암호화, 인코딩

7. 응용 계층
   - 사용자와 애플리케이션 간의 인터페이스를 제공합니다.
   - 웹 브라우저, FTP


<br>

# 주소창에 naver.com을 치면 어떤 일이 일어날까?
## 1. URL 입력 및 DNS 조회 
   사용자가 웹 브라우저에 naver.com 을 입력합니다.  
      
   브라우저는 먼저 DNS 서버에 도메인 네임(naver.com)의 IP 주소를 요청합니다.
   이 과정을 통해 도메인 네임을 IP 주소로 변환합니다.

   > #### DNS
   > 도메인 네임에 매핑되는 IP 주소를 알려줍니다.



<br>



## 2. 데이터 링크 계층
   DNS 쿼리로 받은 IP 주소를 가지고 개인의 컴퓨터를 빠져나와 스위치에 패킷을 전송합니다. 
   
   스위치에서 ARP 테이블을 통해서 IP 주소에 해당하는 MAC 주소를 찾습니다.  
   
   해당 네트워크 내에 있는 장치 중 이 MAC 주소를 가진 장치가 있는지 확인합니다.
   ARP 테이블에 해당하는 ARP 요청을 네트워크에 브로드캐스트하여 MAC 주소를 알아냅니다.


![router.png](https://github.com/user-attachments/assets/b48a0a42-7f85-4d88-94be-a67afb059cea)

#### 스위치?
> - **네트워크 내에서 여러 장치 간에** 데이터를 전송하는 장치
> - 주로 로컬 네트워크(LAN)에서 사용됩니다. 
> - MAC 주소를 사용하여 패킷을 네트워크 내에서 전송합니다.
> - 스위치는 여러 포트를 가지고 있으며, 각 포트는 개별적인 네트워크 장치에 연결됩니다.
> - 포트 간에 데이터를 전송, 관리하며 네트워크 트래픽을 효율적으로 관리합니다.
> - 패킷이 동일 네트워크 내의 장치가 아닌 경우, 패킷 공유기로 전달합니다.
> - 이때, 패킷의 목적지로 가는 최적의 경로는 공유기가 처리합니다.
> - 2~4 계층 까지 처리할 수 있는 장비이나 주로 2계층 처리!
  
  

#### 스위치와 공유기로 보는 데이터 이동 과정?
> 네트워크 구성에서는 스위치와 공유기가 함께 사용됩니다.
> 
> 네트워크에서 데이터가 이동하는 과정을 보면
> ##### 1. 내부 네트워크 (LAN):
   컴퓨터, 서버, 프린터 등 네트워크에 연결된 장치들은 모두 스위치에 연결된다
   스위치는 이 장치들 간에 데이터를 전송하고 관리합니다
   내부 네트워크에서 통신할 때는 스위치를 통해 데이터가 전달된다 (나 <-> 아빠)
   ex) 컴퓨터 A에서 컴퓨터 B로 데이터를 보낼 때,
   스위치는 컴퓨터 B의 MAC 주소를 찾아 해당 포트로 데이터를 전송한다 
> 
> ##### 2. 라우터 (공유기)를 통한 외부 네트워크 (인터넷) 연결:
   공유기는 내부 네트워크와 외부 네트워크(인터넷)를 연결하는 역할을 한다
   공유기는 외부 네트워크와의 통신을 관리하고 내부 네트워크의 장치들이 인터넷에 접속할 수 있도록 한다
   내부 네트워크에 연결된 모든 장치는 공유기에 연결되어 있으며,
   데이터가 외부 네트워크로 전송될 때는 공유기를 통해 전송된다  
> 
> 따라서 데이터가 내부 네트워크에서 스위치를 통해 이동한 후, 외부 네트워크로 전송될 때는 공유기를 통해 이동합니다.



<br>


#### IP 주소와 MAC 주소
> ##### 🟣 왜 IP 주소가 아닌 MAC 주소일까?
   IP 주소는 LAN 카드에 연결되어 있는 회선(랜선)의 주소이다.
   따라서 고정되어 있는 값이 아니라 인터넷 망에 접속할 때마다 달라진다

> ##### 🟣 그럼 MAC 주소는?
   **네트워크 상에서** 서로를 구분하기 위해 장치마다 할당된 물리적인 주소로
   인터넷이 가능한 장비들이 가지고 있는 물리적인 주소로 고정되어 있는 값입니다.

> ##### 🟣 IP 주소?
   랜선을 찾아가는 라우팅 기법은 패킷에 포함된 IP주소(회선의 위치) 를 추적해서 최단 경로를 선택한다.
   IP 주소는 논리적인 주소이기 때문에 이 IP에서 IP주소로 목표된 네트워크로 추적해서 패킷을 보낸 뒤
   그곳에서 그 IP에 등록된 MAC 주소로 변환되어 그 컴퓨터로 패킷을 전송하게 된다.

> ##### 🟣 MAC 주소로만 통신하면 안 되나?
   집에서 naver.com의 웹 서버를 찾는다고 가정하면,
   ISP내의 모든 라우터들은 전세계 모든 서버들의 MAC 주소를 다 가지고 있어야 한다.
   즉, 하나하나 MAC 주소에 대해 라우팅 해줘야 한다.
   하지만 IP 주소 체계는 변경 가능하고, 라우팅하는 데 효과적이다.
   
   > **결론** : IP는 최적의 경로를 찾아주는 라우팅을 하기 위한 주소이고
   실질적인 통신은 MAC 주소로 한다!





> 컴퓨터를 켜면 스위치에 신호가 들어간다  
>  나 : 스위치야 나 켜졌으니까 IP 주소를 주겠니?  
>  공 : 자 ~ 이거 너 IP야~~  
> 이런식으로 IP를 알려준다
> 
> -> 이후 스위치는 다른 컴퓨터와 핸드폰에 이런 IP 주소에 이런 MAC 주소를 갖는 아이가 들어왔어~~
라며 브로드캐스트를 한다
> 
> 그러고 나면 이제 스위치 안에 있는 모든 컴퓨터와 네트워크는 ARP 테이블에 정보를 하나 추가한다
  
  

#### 랜? 이더넷? arp?토큰링
> 만약 공유기에 1000대의 컴퓨터가 있다
   그러면 그 1000대의 컴퓨터가 켜졌다/꺼졌다 할 텐데 그럴때마다 모든 컴퓨터에게
   브로드캐스트를 날려서 ARP테이블을 업데이트 시켜야한다 
>  
> 그렇게 되면 그 1000대의 컴퓨터는 불필요하나 작업을 계속하게 된다. 
>   
> 그러면 부담이 생기기 때문에 브로드캐스트가 되는 범위를 좁혀줘야한다. 그리고 이 범위를 구분하기 위한 것이 넷 마스크이다. 
>   
> 즉, 넷 마스크는 네트워크를 구분하기 위한 것이다.  
> 
> OSI 관점에서 IP와 넷마스크 주소가 동일한 애들은 같은 네트워크로 본다 (AND 연산)
> 같은 네트워크에 있는 컴퓨터는 브로드캐스트와 arp를 공유하게 되고 네트워크가 다르면
영향을 받지 않는다

<br>



## 3-1. 해당 네트워크에 MAC 주소가 있는 경우 

   MAC 주소를 찾은 후 스위치는 해당 MAC주소를 가진 컴퓨터로 패킷을 전달합니다. 이 과정에서 데이터 링크 계층의 프레임을 사용합니다.



<br>



## 3-2. 해당 네트워크에 MAC 주소가 없는 경우 -> 라우터를 통한 네트워크 계층  

   네트워크 내에 MAC 주소가 없으면 스위치에서 라우터(공유기)를 통해 다른 네트워크로 이동합니다.
   
   네트워크 계층에서는 네트워크 간의 통신이 일어납니다.

   그리고 이제 naver.com 을 담당하는 라우터를 IP 주소를 이용하여 찾습니다.

   출발지의 장치는 네이버IP 주소를 기반으로 라우팅 테이블을 사용하여 다음 라우터를 결정합니다.
   그리고 네이버 IP 주소가 있는 라우터로 패킷을 전송합니다.
   
   이 과정에서 출발 장치의 MAC 주소를 목적지 라우터의 MAC 주소로 설정하여 패킷을 전송합니다. 
   라우터를 거칠때마다 라우터끼리 정보를 서로 공유하고 업데이트하며 최적화된 경로를 제공합니다.

#### 라우터?
   > - 네트워크 계층에서 동작하며, 패킷을 **서로 다른 네트워크 간에** 데이터 패킷을 전달하는 장치
   > - 라우팅 과정을 통해 목적지 네트워크에 도착하면, 해당 네트워크의 스위치가 패킷을 처리합니다.
   > - 이 스위치는 다시 ARP 요청을 통해 최종 목적지 MAC 주소를 찾고, 패킷을 최종 장치로 전달합니다.
   > - 공유기는 방화벽, DHCP 서버, 포트 포워딩 등의 기능을 제공


   > 집 안 내부와 같이 작은 공간에서 연결되는 친구들을 LAN 이라고 한다
     LAN 은 집 안 사람들끼리 서로 간에 정보는 전달할 수는 있어도,
     네이버 홈페이지에 들어가거나 멀리 있는 사람에게 연락은 할 수가 없다.   
   > 그래서 있는 것이 ISP(Internet Service Provider) 이다. 
   > 
   > 여기에 우리가 잘 알고있는 SK, KT, U+ 가 있다.  
   >  
   > 이 회사 들이 우리나라 곳곳에 인터넷 케이블을 깔아두었고   
   > 우리는 돈을 지불하고 이 케이블을 사용하는 것이다   
   >   
   > 이렇게 ISP 등이 제공해주는 더 큰 범위의 네트워크를 WAN이라고 한다.  
   > 이렇게 집 안 컴퓨터들은 공유기나 ISP가 제공하는 장비들을 통해 WAN에 연결된다   
   > WAN 은 LAN 으로 구성된 네트워크(집, 회사, 건물) 들을 연결해주는 역할을 한다

   출발지 장치는 패킷을 보낼 때 자신의 MAC 주소를 설정합니다.
   이 MAC 주소는 출발지 장치의 네트워크 카드를 식별합니다.  
 
   목적지 장치의 MAC 주소는 직접적으로 설정되지 않습니다.
   대신 패킷을 다음으로 보낼 라우터의 MAC 주소로 설정됩니다.
   라우터는 목적지에 패킷을 전달하기 위해 중간에 패킷을 전달하는 역할을 합니다.  
 
   이렇게 하면 목적지에 도달하기 위해 패킷이 지나는 모든 라우터는 패킷을 수신하고,
   다음으로 전달해야 할 곳을 알아내기 위해 자신의 MAC 주소를 사용합니다.
   최종적으로 패킷은 목적지에 도달하고, 목적지 장치의 MAC 주소를 사용하여
   목적지 장치에 전달됩니다.  
 
   따라서 출발지 장치의 MAC 주소는 출발지를 식별하는 데 사용되고,
   목적지 장치의 MAC 주소는 직접적으로 설정되지 않고, 다음으로 패킷을 보낼
   라우터의 MAC 주소로 설정됩니다.  

  
#### 출발지 장치의 네트워크 카드를 식별해야하는 이유가 있어?
- 네트워크에서 효율적인 통신을 가능하게 하기 위함

1. 패킷 라우팅: 네트워크에서 패킷을 보낼 때, 출발지 장치의 네트워크 카드는
   패킷의 출발지를 식별하는 데 사용됩니다.
   이를 통해 목적지로 패킷을 전송할 때 어디서 왔는지를 알 수 있습니다.

2. 네트워크 보안: 네트워크 보안에서 출발지 장치의 네트워크 카드는
   인증 및 접근 제어에 사용됩니다.
   네트워크에 접근하려는 디바이스가 실제로 인가된 디바이스인지 확인하기 위해
   네트워크 카드의 고유 식별 정보가 사용됩니다.

3. 네트워크 장애 해결: 네트워크에서 문제가 발생할 때,
   네트워크 카드의 식별 정보를 사용하여 문제를 해결할 수 있습니다.
   각 장치의 네트워크 카드는 고유한 식별자를 가지고 있으므로,
   문제가 발생한 장치를 식별하고 추적하는 데 사용될 수 있습니다.  
     



<br>



## 4. 패킷 전달
   패킷은 이러한 과정을 반복하여 네이버 서버에 도착합니다.



<br>



## 5. 전송 계층
   네이버 서버가 패킷을 수신한 후, TCP, UDP 프로토콜을 이용해서 클라이언트와 서버간의 연결을 설정합니다.
   연결이 정상적으로 이루어지면 소켓을 생성하고 열어서 데이터를 주고 받을 준비를 합니다.

   ex) **peer 2 peer ( host to host )**  

	택배로 치면 그 전까지의 과정은 택배기사가 문 앞까지 배송해 준 과정이고
	전송계층(4)은 내가 택배의 주인(집 구성원)에게 가져다 주는 것을 말한다


#### TCP, UDP 가 공통적으로 포트라는 것을 가지고 있는데 이건 왜 필요할까?
> - 클라이언트 프로그램이 네트워크 상의 특정 프로그램을 지정할 때 사용
> - 어느 서버에 접속해야하는지 포트번호를 통해 지정
> - 어떤 프로그램이 해당 서비스를 담당하는지 알기위해서 사용한다
> - 만약 우리 컴퓨터에 여러 개의 프로그램이 돌고 있는데 (브라우저도, 워드, 파워포인트 등)
    프로그램들이 다 네트워크가 필요한 경우 패킷이 컴퓨터에 왔을때 이 패킷이 많은 프로그램들 중
    어떤 프로그램이 요청한 건 지를 알 수 가 없다
> - 그래서 어떤 프로그램이 해당 패킷을 요청했는지 컴퓨터 내부에서 알기 위해서 사용된다
>   
> ex ) https : 443, http : 80


#### 소켓?
> **데이터를 읽고 쓸 수 있는 하나의 통로**
> - 4 계층에서 처리된 데이터를 5 계층으로 보내줍니다.



<br>



## 6. 세션 계층   
그러면 5계층에서 세션을 열어서 실제로 데이터를 교환합니다.
세션은 상태를 유지하기 위한 기능으로 세션을 통해 클라이언트와 서버의 연결이 유지됩니다.

#### 세션이란?
> **키워드 : 상태유지**
> - 유저의 로그인, 서비스 이용 상태 유지를 위해 사용합니다.
> - naver.com 에 접속을 한 이후에 재접속을 했을 때
    내가 아까 걔라는 것을 알기 위해서 서버가 나에 대한 정보를 저장해두고 session Id 발급한다
> - 이후에 내가 그 session Id를 들고가면 내가 아까 걔인지 알 수 있게 해준다
> - 유저가 로그인하거나 서비스를 이용하는 동안 상태가 유지되는 것을 말한다




<br>



## 7. 표현 계층   
   그리고 6계층에서 데이터가 네이버 서버에서 클라이언트로 전달되기 전에 필요한 인코딩, 암호화 등을 처리합니다.

   ex) 실제 사용하는 서비스로 포장을 뜯어서 물건을 확인하는 것과 비슷하다.
   우리가 살 수 있는 물건이 많은 것처럼 7계층에는 많은 서비스가 존재한다


<br>



## 8. 응용계층
   데이터 형식을 변환한 후 7계층엣서 브라우저는 웹 페이지를 렌더링하고, 사용자가 웹사이트와 상호작용할 수 있도록 합니다.



#### 그 중 HTTP는 뭘까 ?
   > - 문자열을 전송하는 프로토콜
   > - 문자열을 전송할때 문자열의 엔터, 대행문자, 특수문자 등을 처리하기 위해
     어떻게 처리하고 몇 개를 쪼개는 등 이러한 부분에 있어서 사전에 정해 놓은 텍스트 기반의 통신 규약
   > - 인터넷에서 데이터를 주고받을 수 있는 프로토콜
   > - 연결을 유지하지 않는 비 연결성 프로토콜 방식
     -> Session 과 Cookie 가 등장
   > - 웹 서비스에서 사용





### 웹서비스
   
   인터넷 기반이 대표 서비스 중 하나  
   
   |이름|프로토콜|포트|기능|
   |:----:|:----:|:----:|:----:|
   |WWW|HTTP|80|웹서비스|
   |Email|SMTP/POP3/IMAP|25/110/114|이메일 서비스|
   |FTP|FTP|21|파일 전송 서비스|
   |DNS|TCP/UDP|53|네임 서비스|
   |NEWS|NNTP|119|인터넷 뉴스 서비스|


   이 서비스 자체는 웹서비스이며 웹 브라우저락고도 부른다
   
   HTTP 프로토콜을 사용해서 이 웹사이트를 사용하는 것이다
   
   웹이라고 하는 서비스를 사용하기 위한 도구가 http이다